<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Audio player</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
  </head>

  <body>
    <div id="app"></div>

    <template id="audio-item-template">
      <div class="card">
        <p class="desc" v-html="item.description"></p>

        <div class="audio-row">
          <audio controls preload="none" :autoplay="autoplay">
            <source :src="item.url" />
          </audio>

          <button
            class="copy-btn"
            type="button"
            :disabled="state === 'copying'"
            :aria-label="ariaLabel"
            @click="copyMediaURL"
          >
            <svg
              v-if="!copied"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              aria-hidden="true"
            >
              <rect x="9" y="9" width="13" height="13" rx="2" />
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
            </svg>

            <svg
              v-else
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              aria-hidden="true"
            >
              <path d="M20 6L9 17l-5-5" />
            </svg>
          </button>

          <span class="copy-feedback" :class="{ show: copied }">
            Copié
          </span>
        </div>
      </div>
    </template>

    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

    <script>
      const { createApp, defineComponent, ref, computed } = Vue;

      const AudioItem = defineComponent({
        name: "AudioItem",
        props: {
          item: { type: Object, required: true },
          autoplay: { type: Boolean, required: false },
        },
        template: "#audio-item-template",
        setup(props) {
          const copied = ref(false);

          function copyMediaURL() {
            const url = new URL(window.location.href);
            url.searchParams.set('media', props.item.url);
            navigator.clipboard.writeText(url.toString());
            copied.value = true;
            setTimeout(() => {
              copied.value = false;
            }, 1500);
          }

          return { copied, copyMediaURL };
        }
      });

      const App = defineComponent({
        components: { AudioItem },
        setup() {
          const filterPattern = ref('');

          const AUDIO_ITEMS = [{
              url: "media/tout_cque_fait_ce_mec_cest_des_conneries.mp3",
              description: "Tout c'que fait ce mec, c'est des conneries.",
            }, {
              url: "media/cest_pas_bieng.mp3",
              description: `- J'ai hypothéqué la maison. Vas-y, explique moi la chose. Allez, engueule moi ! J'ai fait une connerie !<br />
              - Bah c'est pas bieng.<br />
              - Oh ! Allez !<br />
              - C'est pas bieng. Fallait pas le faire.<br />
              - Oh putain.
              `,
            }, {
              url: "media/donald_duck.mp3",
              description: `- C'est qui l'patron ?<br />
              - C'est moi.<br />
              - On dirait Donald Duck.`
            }, {
              url: "media/putain_cest_bon_ca.mp3",
              description: "Putain ! Ahhh ! C'est bon ça !"
            }, {
              url: "media/bras_casses.mp3",
              description: "Je suis tombé sur une belle bande de bras cassés."
            }, {
              url: "media/cest_degueulasse.mp3",
              description: "C'est dégueulasse."
            }, {
              url: "media/une_vraie_merde_cest_a_chier.mp3",
              description: "Une vraie merde, c'est à chier ça."
            }, {
              url: "media/jvomis_maintenant.mp3",
              description: "J'vomis maintenant, ou j'attends un peu là ?"
            }, {
              url: "media/pate_de_vomi.mp3",
              description: "On dirait un gros paté de vomi dans mon assiette. C'est pas joli du tout."
            }, {
              url: "media/oh_la_vache.mp3",
              description: "Oh la vache !"
            }, {
              url: "media/ca_va_jusquau_fond.mp3",
              description: "Ça va jusqu'au fond ! Ça va jusqu'au fond. Ça va jusqu'au fond ! Putain !"
            }, {
              url: "media/tu_travailles_dans_la_merde.mp3",
              description: "Tu travailles dans la merde. Tu fais d'la merde, tu travailles dans la merde !"
            }, {
              url: "media/ah_ouais.mp3",
              description: "Ah ouais !"
            }, {
              url: "media/alors_la_jhallucine.mp3",
              description: "Alors là, j'hallucine !"
            }, {
              url: "media/ca_ressemble_a_rien.mp3",
              description: "Ça ressemble à rien."
            }, {
              url: "media/cest_insupportable_ce_comportement.mp3",
              description: "C'est insupportable ce comportement."
            }, {
              url: "media/cest_lourd_pis_cest_moche.mp3",
              description: "C'est ... putain c'est lourd...puis c'est moche."
            }, {
              url: "media/cest_ni_fait_ni_a_faire.mp3",
              description: "C'est ni fait, ni à faire !"
            }, {
              url: "media/cest_pas_mal_ca.mp3",
              description: "C'est pas mal ça !"
            }, {
              url: "media/cest_quoi_ce_truc.mp3",
              description: "C'est quoi ce truc ?"
            }, {
              url: "media/cest_surrealiste.mp3",
              description: "C'est surréaliste."
            }, {
              url: "media/dis_le_moi_putain_si_tas_pas_besoin_d_aide.mp3",
              description: "Dis le moi putain si t'as pas b'soin d'aide ! Dis moi : j'ai pas b'soin d'aide !"
            }, {
              url: "media/et_voila_cest_le_bordel_en_cuisine.mp3",
              description: "Et voilà, c'est déjà le bordel en cuisine ! Ça va être une catastrophe ce service."
            }, {
              url: "media/gourmande.mp3",
              description: "Gourmande."
            }, {
              url: "media/il_ma_impressione.mp3",
              description: "Il m'a impressioné !"
            }, {
              url: "media/je_crois_que_je_vais_aller_la_secouer_un_peu.mp3",
              description: "Je crois que j'vais aller la s'couer un peu. Ça commence à bien faire ce comportement."
            }, {
              url: "media/je_nai_jamais_vu_ca.mp3",
              description: "Je n'ai jamais vu ça !"
            }, {
              url: "media/je_suis_epate.mp3",
              description: "Alors là, je suis épaté."
            }, {
              url: "media/je_suis_vraiment_decu_par_son_comportement.mp3",
              description: "Je suis vraiment déçu par son comportement."
            }, {
              url: "media/jtemmerde.mp3",
              description: "J't'emmerde ?"
            }, {
              url: "media/mais_cest_quoi_ca.mp3",
              description: "Mais c'est quoi ça ?!"
            }, {
              url: "media/non_mais_il_se_fiche_de_moi.mp3",
              description: "Non mais il se fiche de moi !"
            }, {
              url: "media/oh_putain_le_massacre.mp3",
              description: "Oh putain le massacre !"
            }, {
              url: "media/plus_cest_dur_plus_jsuis_motive.mp3",
              description: "Plus c'est dur, plus j'suis motivé."
            }, {
              url: "media/putain_de_merde.mp3",
              description: "Putain de merde"
            }, {
              url: "media/respect_mec.mp3",
              description: "Respect, mec."
            }, {
              url: "media/tu_sers_a_rien.mp3",
              description: "Tu sers à rien."
            }
          ];

          const params = new URLSearchParams(window.location.search);
          const defaultMedia = params.get('media');

          function isMediaAutoplayed(url) {
            return url === defaultMedia;
          }

          const items = computed(() => {
            const lower = filterPattern.value.toLocaleLowerCase();
            return AUDIO_ITEMS.filter((item) => item.description.toLocaleLowerCase().includes(lower));
          });

          return { items, filterPattern, isMediaAutoplayed };
        },
        template: `
          <div class="container">
            <div class="filter-wrapper">
              <button v-if="filterPattern" class="clear-btn" type="button" @click="filterPattern = ''">X</button>
              <input type="text" class="filter-input" placeholder="Filtrer" v-model="filterPattern" />
            </div>
            <AudioItem v-for="item of items" :key="item.url" :item="item" :autoplay="isMediaAutoplayed(item.url)" />
          </div>
        `
      });

      createApp(App).mount("#app");
    </script>
  </body>
</html>
